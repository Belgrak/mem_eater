# Расход памяти на Linux и Windows

В этом эксперименте мы исследовали поведение операционных систем при выделении памяти через `malloc`. 

Для тестов использовалась программа `mem_eater`, которая выделяет 4 GiB памяти и проходится по ним с шагом в одну страницу (4 KiB), выполняя либо чтение (`r`), либо запись (`w`).

---

## Linux

Используем `htop` для наблюдения за двумя метриками:
*   **VIRT** — сколько памяти программа *попросила*.
*   **RES** — сколько физической памяти ей *дали*.

### Сценарий A: Запись (`./mem_eater w`)
*   **Старт:** VIRT сразу прыгает до 4 GiB. RES — почти ноль (~1.5 MiB).
*   **Процесс:** Нажимаем Enter. Программа пишет единички в массив. С каждым шагом (128 MiB) полоска RES в `htop` ползет вверх.
*   **Итог:** К концу работы **RES = 4 GiB**.
*   **Вердикт:** Честная трата ресурсов. При попытке записи происходит Page Fault, и ядро выделяет реальную физическую страницу.

### Сценарий B: Чтение (`./mem_eater r`)
*   **Старт:** VIRT = 4 GiB, RES ≈ 0.
*   **Процесс:** Программа «читает» весь массив. Мы видим, как бегут проценты выполнения.
*   **Итог:** **RES не меняется!** Он так и остается на уровне ~1.5 MiB.
*   **Вердикт:** Linux знает, что свежая память должна быть занулена. Вместо того чтобы реально заполнять планки RAM нулями, ОС мапит все виртуальные страницы на *одну и ту же* физическую страницу, доступную только для чтения.

---

## Windows

**Сборка:**
Используем MinGW-w64.
```bash
# Компиляция
x86_64-w64-mingw32-gcc -O2 mem_eater.c -o mem_eater.exe
```

### Тест на Windows 10
Запускаем `mem_eater.exe` на Windows 10. Смотрим в **Диспетчер задач**.
*   *Commit Size (Выделенная память)* — аналог VIRT.
*   *Working Set (Рабочий набор)* — аналог RES.

#### Режим `w` (Write)
*   **Commit:** 4 GB.
*   **Working Set:** Растет ступенчато по мере нажатия Enter, пока не сожрет все 4 Гб.

#### Режим `r` (Read)
*   **Commit:** 4 GB.
*   **Working Set:** **Остается мизерным (~2-4 MB)**.
*   **Почему:** Чтение неинициализированной памяти перенаправляется на системную нулевую страницу. Физическая RAM не тратится.

## Вывод

1.  `malloc` — только "обещание" памяти, а не реальное выделение
2. Реальная память даётся только когда вы начинаете писать в неё
3. Чтение пустой памяти ничего не стоит для системы